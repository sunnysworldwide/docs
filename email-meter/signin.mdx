---
title: 'Connect Microsoft Account'
openapi: 'POST /email-meter/signin/{code}'
---

Authenticates and links a Microsoft account for Email Meter analytics. This endpoint exchanges an authorization code for access tokens and sets up email subscriptions.

## Request

### Headers

| Name           | Type   | Required | Description          |
|----------------|--------|----------|----------------------|
| Authorization | string | Yes      | Bearer token        |

### Path Parameters

| Parameter | Type   | Required | Description                                      |
|-----------|--------|----------|--------------------------------------------------|
| code      | string | Yes      | Authorization code returned by Microsoft OAuth after user consent |

#### Parameter Details
- **code**: Used to obtain access and refresh tokens from Microsoft
- Must be obtained from Microsoft OAuth 2.0 flow
- Code expires quickly (typically 10 minutes)
- Single-use token

## Response

### 200 OK - Successfully authenticated and configured

```json
{
  "message": "Success",
  "data": {
    "subscriptionId": "a12b34cd-56e7-890f-12gh-3456ijkl7890",
    "accessToken": "EwAoA8l6BAAAx...",
    "refreshToken": "M.R3_BAY.4a8b9c...",
    "expiresIn": 3600,
    "mailbox": "user@company.com"
  }
}
```

### 400 Bad Request

```json
{
  "error": {
    "code": "INVALID_CODE",
    "message": "Invalid or expired authorization code"
  }
}
```

### 401 Unauthorized

```json
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Missing or invalid token"
  }
}
```

### 500 Internal Server Error

```json
{
  "error": {
    "code": "SERVER_ERROR",
    "message": "Internal server error"
  }
}
```

## Example

```bash
curl -X POST 'http://localhost:2000/email-meter/signin/0.AAAA1sdfjklsdfLKJ1234xyz...' \
  -H 'Authorization: Bearer your-jwt-token'
```

## Notes

- This endpoint requires a valid JWT token for authentication
- The authorization code must be obtained from Microsoft's OAuth 2.0 flow
- Successfully connecting sets up real-time email monitoring
- Access tokens are stored securely for future API calls
- Email subscriptions are automatically configured for new message notifications
- The integration enables all Email Meter analytics features

## OAuth Flow

1. **Redirect User**: Send user to Microsoft OAuth consent screen
2. **Get Authorization Code**: Microsoft redirects back with authorization code
3. **Exchange Code**: Call this endpoint to exchange code for access tokens
4. **Setup Monitoring**: System automatically configures email subscriptions
5. **Start Analytics**: Email Meter begins tracking and analyzing emails

## Security Considerations

- Authorization codes are single-use and expire quickly
- Access tokens are refreshed automatically using refresh tokens
- All email data is processed securely and in compliance with privacy policies
- Users can revoke access at any time through Microsoft account settings

## Prerequisites

- Valid Microsoft 365 or Outlook.com account
- Appropriate Microsoft Graph API permissions
- Admin consent for organization-wide email access (if applicable)
- Valid JWT token from COMPASS authentication

## Post-Setup

After successful authentication:
- Real-time email monitoring begins
- Historical email analysis starts (may take time for large mailboxes)
- All Email Meter statistics endpoints become available
- Webhook notifications are configured for new emails

## Troubleshooting

- **Invalid Code**: Ensure the code is fresh and obtained from Microsoft OAuth
- **Insufficient Permissions**: Check Microsoft Graph API permissions
- **Mailbox Access**: Verify the mailbox is accessible and not locked
- **Network Issues**: Check firewall and proxy settings for Microsoft Graph API
